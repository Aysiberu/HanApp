<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" /><meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>HanApp | Provider Sign up</title>
    <link rel="stylesheet" href="signuppage.css" />
  </head>
  <body>
    <header>
      <img src="/assets/logo.png" alt="HanApp" />
      <a href="landingpage.html">Home</a>
    </header>

    <main style="max-width:920px;margin:24px auto;padding:20px;background:#fff;border-radius:6px;border:1px solid #eee">
      <h1>Sign up as a Service Provider</h1>
      <p>First, create your account (same as a regular user). After signup you'll continue to add provider-specific information.</p>

      <form id="providerSignupForm">
        <div style="display:flex;gap:12px;flex-wrap:wrap">
          <input id="firstName" placeholder="First name" required />
          <input id="middleName" placeholder="Middle name" />
          <input id="lastName" placeholder="Last name" required />
          <input id="extName" placeholder="Ext" maxlength="6" />
        </div>

        <div style="display:flex;gap:12px;margin-top:12px">
          <input id="email" type="email" placeholder="Email" required style="flex:1" />
          <input id="mobile" placeholder="Mobile" />
        </div>

        <div style="display:flex;gap:12px;margin-top:12px">
          <input id="location" placeholder="Location (city/town)" required style="flex:1" />
          <input id="zip" placeholder="ZIP" />
        </div>

        <div style="display:flex;gap:12px;margin-top:12px">
          <input id="password" type="password" placeholder="Password (min 8 chars)" required style="flex:1" />
          <input id="confirmPassword" type="password" placeholder="Confirm password" required style="flex:1" />
        </div>

        <div style="margin-top:12px">
          <button type="submit">Create Provider Account</button>
        </div>
      </form>

      <p style="margin-top:12px;color:#666">Already have an account? <a href="loginpage.html">Log in</a></p>
    </main>

    <script>
      document.getElementById('providerSignupForm').addEventListener('submit', async function(e){
        e.preventDefault();
        const firstName = document.getElementById('firstName').value.trim();
        const middleName = document.getElementById('middleName').value.trim();
        const lastName = document.getElementById('lastName').value.trim();
        const extName = document.getElementById('extName').value.trim();
        const email = document.getElementById('email').value.trim();
        const mobile = document.getElementById('mobile').value.trim();
        const location = document.getElementById('location').value.trim();
        const zip = document.getElementById('zip').value.trim();
        const password = document.getElementById('password').value;
        const confirm = document.getElementById('confirmPassword').value;
        if (password !== confirm) return alert('Passwords do not match');
        if (password.length < 8) return alert('Password must be >= 8 chars');

        try {
          const res = await fetch('/api/provider_signup', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ firstName, middleName, lastName, extName, email, mobile, location, zip, password }) });
          const body = await res.json();
          if (!res.ok) throw new Error(body.error || 'Could not create provider account');
          // redirect to extra provider details page with user id and provider id
          const uid = body.user?.id; const pid = body.providerId;
          // pass user and provider Id so next step can attach details
          window.location.href = `/provider_extra.html?userId=${encodeURIComponent(uid)}&providerId=${encodeURIComponent(pid||'')}`;
        } catch (err) { alert(err.message || 'Error'); }
      });
    </script>
  </body>
</html>
