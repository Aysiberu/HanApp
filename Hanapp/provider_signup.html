<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" /><meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>HanApp | Provider Sign up</title>
    <link rel="stylesheet" href="app.css" />
    <link rel="stylesheet" href="signuppage.css" />
  </head>
  <body>
    <header>
      <img src="image/Logo.png" alt="HanApp" />
      <a href="landingpage.html">Home</a>
    </header>

    <div class="container">
      <div class="card">
        <h2 class="heading">Sign up as a Service Provider</h2>
        <div class="divider"></div>
        <p style="color:var(--muted);">First, create your account (same as a regular user). After signup you'll continue to add provider-specific information.</p>

      <form id="providerSignupForm">
        <div style="display:flex;gap:12px;flex-wrap:wrap">
          <input id="firstName" placeholder="First name" required />
          <input id="middleName" placeholder="Middle name" />
          <input id="lastName" placeholder="Last name" required />
          <input id="extName" placeholder="Ext" maxlength="6" />
        </div>

        <div style="display:flex;gap:12px;margin-top:12px">
          <input id="email" type="email" placeholder="Email" required style="flex:1" />
          <input id="mobile" placeholder="Mobile" />
        </div>

        <div style="display:flex;gap:12px;margin-top:12px">
          <select id="location" required style="flex:1">
            <option value="">-- Select Municipality / City --</option>
            <option>Adams</option>
            <option>Bacarra</option>
            <option>Badoc</option>
            <option>Bangui</option>
            <option>Banna</option>
            <option>Burgos</option>
            <option>Carasi</option>
            <option>Currimao</option>
            <option>Dingras</option>
            <option>Dumalneg</option>
            <option>Laoag</option>
            <option>Marcos</option>
            <option>Nueva Era</option>
            <option>Pagudpud</option>
            <option>Piddig</option>
            <option>Pinili</option>
            <option>San Nicolas</option>
            <option>Sarrat</option>
            <option>Solsona</option>
            <option>Vintar</option>
          </select>
          <input id="zip" placeholder="ZIP" inputmode="numeric" pattern="\d*" />
        </div>

        <div style="display:flex;gap:12px;margin-top:12px">
          <input id="houseNumber" placeholder="House / Unit No." style="flex:1" />
          <input id="street" placeholder="Street / Barangay" style="flex:1" />
        </div>

        <div style="display:flex;gap:12px;margin-top:12px">
          <input id="password" type="password" placeholder="Password (min 8 chars)" required style="flex:1" />
          <input id="confirmPassword" type="password" placeholder="Confirm password" required style="flex:1" />
        </div>

        <div style="margin-top:12px">
          <button type="submit">Create Provider Account</button>
        </div>
      </form>

      <p style="margin-top:12px;color:var(--muted)">Already have an account? <a href="loginpage.html">Log in</a></p>
        </div>
      </div>

    <script>
      document.getElementById('providerSignupForm').addEventListener('submit', async function(e){
        e.preventDefault();
        const firstName = document.getElementById('firstName').value.trim();
        const middleName = document.getElementById('middleName').value.trim();
        const lastName = document.getElementById('lastName').value.trim();
        const extName = document.getElementById('extName').value.trim();
        const email = document.getElementById('email').value.trim();
        const mobile = document.getElementById('mobile').value.trim();
        const location = document.getElementById('location').value;
        const zip = document.getElementById('zip').value.trim();
        const password = document.getElementById('password').value;
        const confirm = document.getElementById('confirmPassword').value;
        if (!/^[0-9]+$/.test(mobile)) return alert('Mobile number must contain only digits');
        if (zip && !/^[0-9]+$/.test(zip)) return alert('ZIP code must contain only digits');
        if (!location) return alert('Please select a location in Ilocos Norte');

        if (password !== confirm) return alert('Passwords do not match');
        if (password.length < 8) return alert('Password must be >= 8 chars');

        try {
          const res = await fetch('/api/provider_signup', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ firstName, middleName, lastName, extName, email, mobile, location, zip, houseNumber: document.getElementById('houseNumber').value.trim(), street: document.getElementById('street').value.trim(), password }) });
          const body = await res.json();
          if (!res.ok) throw new Error(body.error || 'Could not create provider account');
          // redirect to extra provider details page with user id and provider id
          const uid = body.user?.id; const pid = body.providerId;
          // pass user and provider Id so next step can attach details
          window.location.href = `/provider_extra.html?userId=${encodeURIComponent(uid)}&providerId=${encodeURIComponent(pid||'')}`;
        } catch (err) { alert(err.message || 'Error'); }
      });

      // enforce digits-only while typing
      const mobileInput = document.getElementById('mobile');
      const zipInput = document.getElementById('zip');
      function keepDigits(){ this.value = this.value.replace(/\D/g,''); }
      if(mobileInput) mobileInput.addEventListener('input', keepDigits);
      if(zipInput) zipInput.addEventListener('input', keepDigits);
    ;
    </script>
  </body>
</html>
